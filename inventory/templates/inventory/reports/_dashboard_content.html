<!-- Stats Grid -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
    <!-- Total Assets -->
    <div class="bg-white rounded-lg shadow-sm p-6 transform transition-all duration-200 hover:-translate-y-1">
        <div class="flex items-center">
            <div class="flex-shrink-0 bg-gradient-to-br from-primary-500 to-primary-600 text-white p-3 rounded-lg">
                <i class="fas fa-laptop text-xl"></i>
            </div>
            <div class="ml-4">
                <p class="text-sm text-gray-500 font-medium">{% trans "Total Assets" %}</p>
                <p class="text-2xl font-semibold text-gray-900">{{ total_assets }}</p>
            </div>
        </div>
    </div>

    <!-- Available Assets -->
    <div class="bg-white rounded-lg shadow-sm p-6 transform transition-all duration-200 hover:-translate-y-1">
        <div class="flex items-center">
            <div class="flex-shrink-0 bg-gradient-to-br from-green-500 to-green-600 text-white p-3 rounded-lg">
                <i class="fas fa-check-circle text-xl"></i>
            </div>
            <div class="ml-4">
                <p class="text-sm text-gray-500 font-medium">{% trans "Available Assets" %}</p>
                <p class="text-2xl font-semibold text-gray-900">{{ available_assets }}</p>
            </div>
        </div>
    </div>

    <!-- Assigned Assets -->
    <div class="bg-white rounded-lg shadow-sm p-6 transform transition-all duration-200 hover:-translate-y-1">
        <div class="flex items-center">
            <div class="flex-shrink-0 bg-gradient-to-br from-cyan-500 to-cyan-600 text-white p-3 rounded-lg">
                <i class="fas fa-user-check text-xl"></i>
            </div>
            <div class="ml-4">
                <p class="text-sm text-gray-500 font-medium">{% trans "Assigned Assets" %}</p>
                <p class="text-2xl font-semibold text-gray-900">{{ assigned_assets }}</p>
            </div>
        </div>
    </div>

    <!-- In Maintenance -->
    <div class="bg-white rounded-lg shadow-sm p-6 transform transition-all duration-200 hover:-translate-y-1">
        <div class="flex items-center">
            <div class="flex-shrink-0 bg-gradient-to-br from-yellow-500 to-yellow-600 text-white p-3 rounded-lg">
                <i class="fas fa-tools text-xl"></i>
            </div>
            <div class="ml-4">
                <p class="text-sm text-gray-500 font-medium">{% trans "In Maintenance" %}</p>
                <p class="text-2xl font-semibold text-gray-900">{{ maintenance_assets }}</p>
            </div>
        </div>
    </div>
</div>

<!-- Charts Grid -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <!-- Department Asset Distribution -->
    <div class="bg-white rounded-lg shadow-sm p-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">{% trans "Department Asset Distribution" %}</h3>
        <div class="h-[300px]">
            <canvas id="departmentChart"></canvas>
        </div>
    </div>

    <!-- Asset Status Distribution -->
    <div class="bg-white rounded-lg shadow-sm p-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">{% trans "Asset Status Distribution" %}</h3>
        <div class="h-[300px]">
            <canvas id="statusChart"></canvas>
        </div>
    </div>

    <!-- Device Models Distribution -->
    <div class="bg-white rounded-lg shadow-sm p-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">{% trans "Device Models Distribution" %}</h3>
        <div class="h-[300px]">
            <canvas id="modelChart"></canvas>
        </div>
    </div>
</div>

<!-- Recent Activity -->
<div class="bg-white rounded-lg shadow-sm">
    <div class="p-6 border-b border-gray-200">
        <div class="flex justify-between items-center">
            <h3 class="text-lg font-medium text-gray-900">{% trans "Recent Activity" %}</h3>
            <a href="{% url 'inventory:global_asset_history' %}" class="text-primary-600 hover:text-primary-700 flex items-center">
                {% trans "View All" %}
                <i class="fas fa-arrow-right ml-2"></i>
            </a>
        </div>
    </div>
    {% if recent_activities %}
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{% trans "Date" %}</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{% trans "Asset" %}</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{% trans "Action" %}</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{% trans "Assigned To" %}</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for activity in recent_activities %}
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ activity.date|date:"M j, Y" }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ activity.asset.name }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ activity.get_action_display }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ activity.employee.get_full_name|default:"-" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="p-6 text-center text-gray-500">{% trans "No recent activity found." %}</div>
    {% endif %}
</div>

<!-- Export Options -->
<div class="flex justify-end mt-6 space-x-4">
    <a href="{% url 'inventory:generate_report_pdf' %}?type={{ report_type }}&date_from={{ date_from }}&date_to={{ date_to }}" 
       class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
        <i class="fas fa-file-pdf mr-2"></i>
        {% trans "Export as PDF" %}
    </a>
</div>

<script>
// Re-initialize charts after HTMX content swap
document.addEventListener('htmx:afterSwap', function() {
    const chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    usePointStyle: true,
                    padding: 20
                }
            }
        }
    };

    // Department Chart
    const departmentCtx = document.getElementById('departmentChart').getContext('2d');
    new Chart(departmentCtx, {
        type: 'bar',
        data: {
            labels: [{% for dept in departments %}'{{ dept.name }}'{% if not forloop.last %},{% endif %}{% endfor %}],
            datasets: [{
                label: '{% trans "Asset Count" %}',
                data: [{% for dept in departments %}{{ dept.asset_count }}{% if not forloop.last %},{% endif %}{% endfor %}],
                backgroundColor: 'rgba(14, 165, 233, 0.8)',
                borderColor: 'rgb(14, 165, 233)',
                borderWidth: 1,
                borderRadius: 4
            }]
        },
        options: {
            ...chartOptions,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    },
                    grid: {
                        drawBorder: false,
                        color: 'rgba(0, 0, 0, 0.05)'
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            }
        }
    });

    // Status Chart
    const statusCtx = document.getElementById('statusChart').getContext('2d');
    new Chart(statusCtx, {
        type: 'doughnut',
        data: {
            labels: ['Available', 'Assigned', 'Maintenance'],
            datasets: [{
                data: [{{ available_assets }}, {{ assigned_assets }}, {{ maintenance_assets }}],
                backgroundColor: [
                    'rgba(34, 197, 94, 0.8)',
                    'rgba(14, 165, 233, 0.8)',
                    'rgba(234, 179, 8, 0.8)'
                ],
                borderColor: [
                    'rgb(34, 197, 94)',
                    'rgb(14, 165, 233)',
                    'rgb(234, 179, 8)'
                ],
                borderWidth: 1
            }]
        },
        options: chartOptions
    });

    // Model Chart
    const modelCtx = document.getElementById('modelChart').getContext('2d');
    new Chart(modelCtx, {
        type: 'bar',
        data: {
            labels: [{% for stat in model_stats %}'{{ stat.model }} ({{ stat.asset_type__display_name }})'{% if not forloop.last %},{% endif %}{% endfor %}],
            datasets: [{
                label: '{% trans "Device Count" %}',
                data: [{% for stat in model_stats %}{{ stat.count }}{% if not forloop.last %},{% endif %}{% endfor %}],
                backgroundColor: 'rgba(14, 165, 233, 0.8)',
                borderColor: 'rgb(14, 165, 233)',
                borderWidth: 1,
                borderRadius: 4
            }]
        },
        options: {
            ...chartOptions,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    },
                    grid: {
                        drawBorder: false,
                        color: 'rgba(0, 0, 0, 0.05)'
                    }
                },
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        maxRotation: 45,
                        minRotation: 45
                    }
                }
            }
        }
    });
});
</script> 